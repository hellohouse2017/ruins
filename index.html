<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ruins Bar 高雄廢墟場地租借 | 預約系統</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700&family=Oswald:wght@400;600&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'ruin-dark': '#121212',
                        'ruin-gray': '#1e1e1e',
                        'neon-pink': '#ff0055',
                        'neon-blue': '#00f3ff',
                        'champagne': '#d4af37',
                    },
                    fontFamily: {
                        sans: ['"Noto Sans TC"', 'sans-serif'],
                        display: ['"Oswald"', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #121212; color: #e0e0e0; }
        input[type="date"] { position: relative; font-size: 1.1rem; }
        input[type="date"]::-webkit-calendar-picker-indicator { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; }
        
        .addon-btn.selected { border-color: #00f3ff; background-color: rgba(0, 243, 255, 0.1); color: white; }
        .addon-btn.selected .check-icon { opacity: 1; background-color: #00f3ff; color: black; }
        .addon-btn.included { border-color: #06c755; background-color: rgba(6, 199, 85, 0.1); color: #88ffaa; cursor: default; }
        
        .plan-card { transition: all 0.3s ease; }
        .plan-card:hover { transform: translateY(-5px); box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); }
        .plan-card:hover img { transform: scale(1.05); }
        .plan-card img { transition: transform 0.8s ease; }
        .wedding-card:hover { border-color: #d4af37; box-shadow: 0 0 30px rgba(212, 175, 55, 0.3); }

        .gallery-item { break-inside: avoid; margin-bottom: 1rem; }
        .sticky-btn { position: fixed; bottom: 30px; right: 20px; width: 60px; height: 60px; background-color: #06c755; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 32px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); z-index: 40; transition: all 0.3s ease; text-decoration: none; cursor: pointer; animation: pulse-green 2s infinite; }
        @keyframes pulse-green { 0% { box-shadow: 0 0 0 0 rgba(6, 199, 85, 0.7); } 70% { box-shadow: 0 0 0 20px rgba(6, 199, 85, 0); } 100% { box-shadow: 0 0 0 0 rgba(6, 199, 85, 0); } }
        
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        .counter-btn { width: 30px; height: 30px; border-radius: 50%; background: #333; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s; }
        .counter-btn:hover { background: #555; }

        .slot-btn { background-color: #1a1a1a; border: 1px solid #444; color: #888; transition: all 0.2s; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .slot-btn:hover { border-color: #666; color: white; }
        .slot-btn.active { background-color: rgba(0, 243, 255, 0.15); border-color: #00f3ff; color: #00f3ff; font-weight: bold; box-shadow: 0 0 10px rgba(0, 243, 255, 0.2); }
        .slot-btn span { font-size: 0.75rem; font-weight: normal; opacity: 0.8; }
    </style>
</head>
<body class="font-sans antialiased selection:bg-neon-pink selection:text-white pb-24">

    <nav class="fixed w-full z-50 bg-ruin-dark/95 backdrop-blur-md border-b border-white/10 shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <span class="font-display text-2xl font-bold tracking-wider text-white">RUINS <span class="text-neon-pink">BAR</span></span>
                </div>
                <div class="hidden lg:block">
                    <div class="ml-10 flex items-baseline space-x-6">
                        <a href="#plans-section" class="text-neon-blue hover:text-white transition px-3 py-2 rounded-md text-sm font-bold border border-neon-blue cursor-pointer"><i class="fas fa-calendar-check mr-1"></i> 方案預約</a>
                        <a href="#gallery" class="hover:text-neon-pink transition px-3 py-2 rounded-md text-sm font-medium">實錄</a>
                        <a href="#video" class="hover:text-neon-pink transition px-3 py-2 rounded-md text-sm font-medium">影音</a>
                        <a href="#reviews" class="hover:text-neon-pink transition px-3 py-2 rounded-md text-sm font-medium">好評</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="relative bg-ruin-gray h-screen flex items-center justify-center overflow-hidden">
        <div class="absolute inset-0 z-0 opacity-40 bg-cover bg-center grayscale" style="background-image: url('images/cover-bg.jpg');"></div>
        <div class="absolute inset-0 bg-gradient-to-t from-ruin-dark via-transparent to-ruin-dark z-10"></div>
        <div class="relative z-20 text-center px-4">
            <h1 class="font-display text-5xl md:text-7xl font-bold text-white mb-4 tracking-widest neon-text-pink">INDUSTRIAL RUINS</h1>
            <p class="text-xl md:text-2xl text-gray-300 mb-8 max-w-2xl mx-auto font-light">高雄鹽埕 × 廢墟美學 × 極致派對體驗</p>
            <a href="#plans-section" class="inline-block bg-neon-pink text-white font-bold py-4 px-10 rounded-full hover:bg-pink-600 transition duration-300 shadow-[0_0_20px_rgba(255,0,85,0.5)] cursor-pointer">
                開始預約旅程
            </a>
        </div>
    </div>

    <section id="plans-section" class="py-20 px-4 bg-ruin-dark relative z-30">
        <div class="max-w-7xl mx-auto">
            <h2 class="text-3xl font-bold text-white mb-10 text-center flex items-center justify-center"><i class="fas fa-list-ul text-neon-blue mr-3"></i> 選擇您的活動方案</h2>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-16">
                <div onclick="handleCardClick('proposal')" class="plan-card cursor-pointer group relative rounded-2xl overflow-hidden border-2 border-neon-pink/50 shadow-[0_0_30px_rgba(255,0,85,0.15)] hover:border-neon-pink bg-zinc-900 flex flex-col">
                    <div class="h-80 md:h-96 overflow-hidden relative w-full">
                        <img src="images/proposal-cover.jpg" alt="高雄求婚佈置" class="w-full h-full object-cover">
                        <div class="absolute bottom-0 left-0 w-full bg-gradient-to-t from-black via-black/50 to-transparent h-32"></div>
                        <div class="absolute bottom-6 left-8">
                            <div class="text-white font-bold text-2xl mb-1 flex items-center"><i class="fas fa-heart text-neon-pink mr-3"></i> 浪漫求婚包場</div>
                            <p class="text-neon-pink text-xl font-bold">平日 $48,000 / 假日 $52,000 起</p>
                        </div>
                    </div>
                    <div class="p-8 flex-grow flex flex-col justify-between">
                        <div>
                            <p class="text-gray-300 mb-4 text-base leading-relaxed">包含氣球佈置、MerryMe燈條與求婚花束。<br>讓廢墟的光影成為你們愛情的最佳見證。</p>
                            <ul class="text-sm text-gray-500 space-y-1 mb-4">
                                <li><i class="fas fa-check text-neon-pink mr-2"></i> 基礎包場方案內容 (含點心)</li>
                                <li><i class="fas fa-check text-neon-pink mr-2"></i> 溫馨氣球 + 拍照背板</li>
                                <li><i class="fas fa-check text-neon-pink mr-2"></i> MerryMe 燈條 & 求婚花束</li>
                            </ul>
                        </div>
                        <div class="text-right text-neon-pink font-bold group-hover:translate-x-2 transition mt-4">查看完整內容 <i class="fas fa-arrow-right ml-1"></i></div>
                    </div>
                </div>

                <div onclick="handleCardClick('wedding')" class="plan-card wedding-card cursor-pointer group relative rounded-2xl overflow-hidden border-2 border-champagne/50 shadow-[0_0_30px_rgba(212,175,55,0.15)] bg-zinc-900 flex flex-col">
                    <div class="h-80 md:h-96 overflow-hidden relative w-full">
                        <img src="images/wedding-cover.jpg" alt="高雄輕婚禮場地" class="w-full h-full object-cover">
                        <div class="absolute bottom-0 left-0 w-full bg-gradient-to-t from-black via-black/50 to-transparent h-32"></div>
                        <div class="absolute bottom-6 left-8">
                            <div class="text-white font-bold text-2xl mb-1 flex items-center"><i class="fas fa-ring text-champagne mr-3"></i> 婚禮派對 & 證婚</div>
                            <p class="text-champagne text-xl font-bold">平日 $35,000 / 假日 $40,000 起</p>
                        </div>
                    </div>
                    <div class="p-8 flex-grow flex flex-col justify-between">
                        <div>
                            <p class="text-gray-300 mb-4 text-base leading-relaxed">提供 After Party 與 證婚儀式+派對 雙重選擇。<br>包含精緻自助點心、酒水暢飲與DJ演出。</p>
                            <ul class="text-sm text-gray-500 space-y-1 mb-4">
                                <li><i class="fas fa-check text-champagne mr-2"></i> Welcome / After Party</li>
                                <li><i class="fas fa-check text-champagne mr-2"></i> 戶外證婚 + 派對</li>
                            </ul>
                        </div>
                        <div class="text-right text-champagne font-bold group-hover:translate-x-2 transition mt-4">查看詳細內容 <i class="fas fa-arrow-right ml-1"></i></div>
                    </div>
                </div>
            </div>

            <div class="border-t border-zinc-800 my-10 relative"><span class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-ruin-dark px-4 text-gray-500 text-sm">更多方案選擇</span></div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <div onclick="handleCardClick('baby')" class="plan-card bg-zinc-900 border border-zinc-700 rounded-xl overflow-hidden cursor-pointer">
                    <div class="h-40 overflow-hidden"><img src="images/baby-cover.jpg" class="w-full h-full object-cover"></div>
                    <div class="p-5">
                        <h4 class="text-lg font-bold text-white mb-1">抓周 / 性別派對</h4>
                        <p class="text-neon-blue font-bold mb-2">平日 $45,000 起</p>
                        <p class="text-gray-500 text-xs">含氣球佈置、道具、精緻點心</p>
                    </div>
                </div>
                <div onclick="handleCardClick('party')" class="plan-card bg-zinc-900 border border-zinc-700 rounded-xl overflow-hidden cursor-pointer">
                    <div class="h-40 overflow-hidden"><img src="images/party-cover.jpg" class="w-full h-full object-cover"></div>
                    <div class="p-5">
                        <h4 class="text-lg font-bold text-white mb-1">慶生 / 各式派對</h4>
                        <p class="text-neon-blue font-bold mb-2">平日 $28,000 起</p>
                        <p class="text-gray-500 text-xs">含酒水、精緻點心、包場</p>
                    </div>
                </div>
                <div onclick="handleCardClick('rental')" class="plan-card bg-zinc-900 border border-zinc-700 rounded-xl overflow-hidden cursor-pointer">
                    <div class="h-40 overflow-hidden"><img src="images/venue-empty.jpg" class="w-full h-full object-cover"></div>
                    <div class="p-5">
                        <h4 class="text-lg font-bold text-white mb-1">純場地租借</h4>
                        <p class="text-neon-blue font-bold mb-2">平日 $10,000 起</p>
                        <p class="text-gray-500 text-xs">平日低消10000 / 假日15000</p>
                    </div>
                </div>
                <div onclick="handleCardClick('meeting')" class="plan-card bg-zinc-900 border border-zinc-700 rounded-xl overflow-hidden cursor-pointer">
                    <div class="h-40 overflow-hidden"><img src="images/meeting-cover.jpg" class="w-full h-full object-cover"></div>
                    <div class="p-5">
                        <h4 class="text-lg font-bold text-white mb-1">會議包場方案</h4>
                        <p class="text-neon-blue font-bold mb-2">平日 $12,000 起</p>
                        <p class="text-gray-500 text-xs">含桌椅、飲品、視聽設備</p>
                    </div>
                </div>
            </div>
            
            <div onclick="handleCardClick('custom')" class="mt-8 bg-zinc-900/50 border border-dashed border-zinc-600 rounded-xl p-4 text-center cursor-pointer hover:border-neon-pink hover:text-neon-pink transition">
                <span class="text-sm">有特殊需求？ 點此選擇 <b>客製化方案</b> (展覽/拍攝/活動)</span>
            </div>
        </div>
    </section>

    <section id="gallery" class="py-20 bg-ruin-dark"><div class="max-w-7xl mx-auto px-4"><h2 class="text-3xl font-bold text-white mb-8 text-center">精彩實錄 Gallery</h2><div class="grid grid-cols-2 md:grid-cols-4 gap-4"><div class="gallery-item"><img src="images/venue-decor-wedding.jpg" alt="高雄鹽埕區戶外證婚場地 Ruins Bar 廢墟風輕婚禮佈置與花藝設計" class="w-full h-64 object-cover rounded-lg hover:opacity-80 transition border border-zinc-800"></div><div class="gallery-item"><img src="images/party-dj-crowd.jpg" alt="高雄私人派對包場推薦 Ruins Bar 深夜DJ活動與霓虹燈光氛圍" class="w-full h-64 object-cover rounded-lg hover:opacity-80 transition border border-zinc-800"></div><div class="gallery-item"><img src="images/proposal-romantic-light.jpg" alt="高雄求婚餐廳場地 浪漫MarryMe燈飾與氣球驚喜企劃" class="w-full h-64 object-cover rounded-lg hover:opacity-80 transition border border-zinc-800"></div><div class="gallery-item"><img src="images/food-buffet.jpg" alt="高雄派對外燴 Buffet 自助餐點 精緻鹹甜點心與酒水服務" class="w-full h-64 object-cover rounded-lg hover:opacity-80 transition border border-zinc-800"></div><div class="gallery-item"><img src="images/baby-party-setup.jpg" alt="高雄寶寶抓周派對場地租借 溫馨親子活動空間與道具" class="w-full h-64 object-cover rounded-lg hover:opacity-80 transition border border-zinc-800"></div><div class="gallery-item"><img src="images/venue-outdoor-vibe.jpg" alt="高雄老屋改建活動場地 戶外露天區域與復古燈串造景" class="w-full h-64 object-cover rounded-lg hover:opacity-80 transition border border-zinc-800"></div><div class="gallery-item"><img src="images/gallery-vibe-1.jpg" alt="高雄特色酒吧包場 工業風廢墟裝潢與適合拍照打卡景點" class="w-full h-64 object-cover rounded-lg hover:opacity-80 transition border border-zinc-800"></div><div class="gallery-item"><img src="images/gallery-decor-1.jpg" alt="高雄小型婚禮場地佈置 質感花藝與客製化背板設計" class="w-full h-64 object-cover rounded-lg hover:opacity-80 transition border border-zinc-800"></div></div></div></section>
    
    <section id="video" class="py-20 bg-zinc-900 border-t border-zinc-800"><div class="max-w-4xl mx-auto px-4 text-center"><h2 class="text-3xl font-bold text-white mb-8 flex items-center justify-center"><i class="fab fa-instagram text-neon-pink mr-3"></i> 影音專區 Video</h2><p class="text-gray-400 mb-6 text-sm">點擊觀看現場活動 Reels</p><div class="flex justify-center"><a href="https://www.instagram.com/reel/DQjucxEEreY/?igsh=MTVsd3JteWFlZTVkbw==" target="_blank" class="group relative block w-full max-w-sm rounded-2xl overflow-hidden border-2 border-zinc-700 hover:border-neon-pink transition duration-300 shadow-[0_0_30px_rgba(0,0,0,0.5)]"><img src="images/video-cover.jpg" onerror="this.src='https://images.unsplash.com/photo-1514525253440-b393452e3720?q=80&w=1000&auto=format&fit=crop'" alt="高雄鹽埕區 Ruins Bar 廢墟酒吧 派對包場活動實錄 與 DJ現場演出氛圍" class="w-full h-96 object-cover transform group-hover:scale-105 transition duration-700 opacity-80 group-hover:opacity-100"><div class="absolute inset-0 bg-black/40 group-hover:bg-black/20 transition"></div><div class="absolute inset-0 flex items-center justify-center"><div class="w-16 h-16 bg-neon-pink/90 rounded-full flex items-center justify-center shadow-[0_0_20px_rgba(255,0,85,0.6)] group-hover:scale-110 transition duration-300"><i class="fas fa-play text-white text-2xl ml-1"></i></div></div><div class="absolute bottom-0 left-0 w-full p-4 bg-gradient-to-t from-black to-transparent text-left"><p class="text-white font-bold text-lg"><i class="fab fa-instagram mr-2"></i> RUINS BAR 派對實錄</p><p class="text-gray-300 text-xs">觀看 Reels 短影音</p></div></a></div><div class="mt-10"><a href="https://www.instagram.com/ruinsbar_kaohsiung/" target="_blank" class="inline-flex items-center text-gray-400 border border-zinc-600 px-6 py-3 rounded-full hover:border-neon-pink hover:text-neon-pink transition">更多活動影片請至 Instagram <i class="fas fa-external-link-alt ml-2"></i></a></div></div></section>

    <section id="reviews" class="py-20 bg-zinc-900 border-t border-zinc-800">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <h2 class="text-3xl font-bold text-white mb-8">五星好評見證</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
                <div class="bg-ruin-gray p-6 rounded-xl border border-zinc-700 text-left">
                    <div class="flex text-yellow-400 mb-2"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></div>
                    <p class="text-gray-300 text-sm mb-4">"在高雄找了很久，終於找到這麼有氛圍的抓周場地！廢墟風拍照起來意外的溫馨，主持人也很會帶氣氛，長輩們都稱讚不已。"</p>
                    <p class="text-neon-blue text-xs font-bold">- 林小姐 (抓周派對)</p>
                </div>
                <div class="bg-ruin-gray p-6 rounded-xl border border-zinc-700 text-left">
                     <div class="flex text-yellow-400 mb-2"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></div>
                    <p class="text-gray-300 text-sm mb-4">"原本擔心求婚會很尷尬，但團隊佈置的燈光真的很美！方案包含的平面攝影也很專業，完美捕捉了女友感動的瞬間，大推！"</p>
                    <p class="text-neon-pink text-xs font-bold">- 張先生 (求婚方案)</p>
                </div>
                <div class="bg-ruin-gray p-6 rounded-xl border border-zinc-700 text-left">
                     <div class="flex text-yellow-400 mb-2"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></div>
                    <p class="text-gray-300 text-sm mb-4">"這次公司舉辦的會議講座選在這裡，大家都很喜歡這裡的輕鬆氛圍。包場的隱私性很好，投影設備和音響都很棒。會後直接轉成餐酒會！"</p>
                    <p class="text-white text-xs font-bold">- 創意設計公司</p>
                </div>
            </div>
            <div>
                <a href="https://www.google.com/search?sca_esv=cb427c73f925e7d3&rlz=1C5CHFA_enTW1093TW1093&si=AMgyJEtREmoPL4P1I5IDCfuA8gybfVI2d5Uj7QMwYCZHKDZ-EzjU63sUD-tLvHl4BxZAN-0S-dqYVPODkv19MMIjBNCxNowPZGTBK8bAINMFp2hI6IhQlTLQrw2UB1vrERdM-kSNrV-TIR5ts-SmwjyZuQ009TARLwzeqQAkRXoi1o3AkSvvp6XZDt-v3q-VlOm6t3PY8yCIch7KgMrhulv0Iy1ms_Yehg%3D%3D&q=%E5%BB%A2%E5%A2%9FRuins%28%E5%8C%85%E5%A0%B4/%E5%A9%9A%E7%A6%AE/%E6%B4%BE%E5%B0%8D/%E6%B1%82%E5%A9%9A/%E6%85%B6%E7%94%9F/%E6%BC%94%E5%87%BA/%E6%B4%BB%E5%8B%95%EF%BC%89%E5%85%A8%E9%A0%90%E7%B4%84%E5%88%B6+%E8%A9%95%E8%AB%96&sa=X&ved=2ahUKEwim0Y-1uJKRAxX7dfUHHYx3JmsQ0bkNegQIJRAE&biw=1973&bih=1046&dpr=2" target="_blank" class="inline-flex items-center text-gray-400 hover:text-white transition text-sm border-b border-gray-600 hover:border-white pb-1">
                    <i class="fab fa-google mr-2"></i> 前往 Google 查看全部真實評論
                </a>
            </div>
        </div>
    </section>

    <footer class="bg-black pt-24 pb-12 border-t border-white/5 relative overflow-hidden">
        <div class="absolute top-0 left-1/2 transform -translate-x-1/2 w-full max-w-2xl h-[1px] bg-gradient-to-r from-transparent via-white/20 to-transparent"></div>
        <div class="max-w-6xl mx-auto px-6 text-center">
            <h2 class="font-display text-4xl md:text-5xl text-white font-bold tracking-[0.3em] mb-3">RUINS BAR</h2>
            <p class="text-zinc-500 text-xs tracking-[0.5em] uppercase mb-16 opacity-70">Kaohsiung / Industrial / Space</p>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-px bg-white/10 border border-white/10 rounded-lg overflow-hidden mb-16 max-w-4xl mx-auto">
                <a href="https://www.google.com/maps/dir//高雄市鹽埕區瀨南街205號" target="_blank" class="bg-black p-8 group hover:bg-zinc-900/50 transition duration-500 cursor-pointer"><div class="text-zinc-500 mb-3 text-xl group-hover:text-neon-blue transition duration-300 transform group-hover:scale-110"><i class="fas fa-location-arrow"></i></div><h4 class="text-zinc-600 text-[10px] uppercase tracking-widest mb-2 group-hover:text-white transition">Navigation</h4><p class="text-zinc-300 text-sm font-light tracking-wide group-hover:text-neon-blue transition">高雄市鹽埕區<br>瀨南街205號</p></a>
                <a href="tel:0932828922" class="bg-black p-8 group hover:bg-zinc-900/50 transition duration-500"><div class="text-zinc-500 mb-3 text-xl group-hover:text-neon-pink transition duration-300 transform group-hover:scale-110"><i class="fas fa-phone"></i></div><h4 class="text-zinc-600 text-[10px] uppercase tracking-widest mb-2 group-hover:text-white transition">Reservation</h4><p class="text-white text-lg font-display tracking-widest group-hover:text-neon-pink transition">0932-828-922</p></a>
                <a href="https://line.me/R/ti/p/@529ldsir" target="_blank" class="bg-black p-8 group hover:bg-zinc-900/50 transition duration-500"><div class="text-zinc-500 mb-3 text-xl group-hover:text-[#06c755] transition duration-300 transform group-hover:scale-110"><i class="fab fa-line"></i></div><h4 class="text-zinc-600 text-[10px] uppercase tracking-widest mb-2 group-hover:text-white transition">Official Line</h4><p class="text-white text-lg font-display tracking-widest group-hover:text-[#06c755] transition">@529ldsir</p></a>
            </div>
            <div class="mb-12 flex flex-wrap justify-center gap-x-6 gap-y-3">
                <span class="text-xs text-zinc-600 hover:text-zinc-400 transition cursor-default">#高雄場地租借</span>
                <span class="text-xs text-zinc-600 hover:text-zinc-400 transition cursor-default">#鹽埕區酒吧</span>
                <span class="text-xs text-zinc-600 hover:text-zinc-400 transition cursor-default">#廢墟風攝影棚</span>
                <span class="text-xs text-zinc-600 hover:text-zinc-400 transition cursor-default">#求婚場地</span>
                <span class="text-xs text-zinc-600 hover:text-zinc-400 transition cursor-default">#抓周派對</span>
                <span class="text-xs text-zinc-600 hover:text-zinc-400 transition cursor-default">#小型婚禮</span>
            </div>
            <div class="text-zinc-700 text-[10px] font-display tracking-widest border-t border-white/5 pt-8 inline-block px-10">2025 RUINS BAR. DESIGNED IN KAOHSIUNG.</div>
        </div>
    </footer>

    <div id="subPlanModal" class="hidden fixed inset-0 z-[70] overflow-y-auto" role="dialog">
        <div class="fixed inset-0 bg-black/90 transition-opacity backdrop-blur-sm" onclick="closeSubModal()"></div>
        <div class="flex min-h-full items-center justify-center p-4">
            <div class="relative transform overflow-hidden rounded-2xl bg-zinc-900 text-left shadow-2xl w-full max-w-lg border border-zinc-700">
                <div class="p-6">
                    <h3 class="text-xl font-bold text-white mb-4 text-center">請選擇詳細方案</h3>
                    <div id="subPlanContainer" class="space-y-4"></div>
                    <button onclick="closeSubModal()" class="mt-6 w-full text-gray-500 text-sm">取消</button>
                </div>
            </div>
        </div>
    </div>

    <div id="bookingModal" class="hidden fixed inset-0 z-[60] overflow-y-auto">
        <div class="fixed inset-0 bg-black/80 transition-opacity backdrop-blur-sm" onclick="closeModal()"></div>
        <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
            <div class="relative transform overflow-hidden rounded-2xl bg-zinc-900 text-left shadow-2xl transition-all sm:my-8 sm:w-full sm:max-w-lg border border-zinc-700">
                <button onclick="closeModal()" class="absolute top-4 right-4 text-gray-400 hover:text-white z-10 p-2"><i class="fas fa-times text-2xl"></i></button>

                <div class="max-h-[85vh] overflow-y-auto p-6 scrollbar-hide">
                    <h3 class="text-center text-white font-bold mb-2 text-2xl flex justify-center items-center"><i class="fas fa-calendar-alt text-neon-blue mr-3"></i> 檔期查詢</h3>
                    <div class="bg-zinc-800 p-3 rounded-lg mb-6 text-center border border-zinc-700">
                        <span class="text-gray-400 text-xs block">您目前選擇的方案</span>
                        <span id="selectedPlanDisplay" class="text-neon-pink font-bold text-lg"></span>
                    </div>

                    <div id="step1">
                        <form id="checkForm" onsubmit="handleCheck(event)" class="space-y-4">
                            <div><label class="block text-neon-blue text-sm font-bold mb-1">1. 選擇預計日期</label><p id="dateBlockTip" class="text-xs text-blue-400 mb-2"></p><div class="relative"><input type="date" id="dateInput" 
       onchange="checkLogic()" 
       onfocus="setDatePickerMin()" 
       onblur="checkLogic()"
       required 
       class="w-full bg-black border border-zinc-700 text-white rounded-lg p-3 focus:border-neon-blue focus:outline-none cursor-pointer">></div><p id="dayTypeLabel" class="text-xs text-gray-500 mt-1 text-right"></p><p id="dateWarning" class="text-neon-pink text-xs mt-1 hidden font-bold"></p></div>
                            <div>
                                <label class="block text-neon-blue text-sm font-bold mb-1">2. 選擇時段</label>
                                <div class="grid grid-cols-3 gap-2 mb-4" id="standardSlots">
                                    <button type="button" onclick="selectSlot('lunch')" id="btnLunch" class="slot-btn py-2 rounded-lg text-sm font-bold">午場<br><span class="text-xs font-normal">11:00-14:00</span></button>
                                    <button type="button" onclick="selectSlot('dinner')" id="btnDinner" class="slot-btn py-2 rounded-lg text-sm font-bold">晚場<br><span class="text-xs font-normal">17:00-20:00</span></button>
                                    <button type="button" onclick="selectSlot('allday')" id="btnAllDay" class="slot-btn py-2 rounded-lg text-sm font-bold hidden">全日<br><span class="text-xs font-normal">09:00-21:00</span></button>
                                </div>
                                <div class="relative border-t border-zinc-700 pt-4 mt-2">
                                    <p class="text-xs text-gray-400 mb-2">或 自訂開始時間 (結束自動計算)</p>
                                    <div class="grid grid-cols-2 gap-4">
                                        <div><label class="text-white text-xs">開始</label><select id="startTime" onchange="customTimeTrigger()" class="w-full bg-black border-zinc-600 text-white rounded p-1"></select></div>
                                        <div><label class="text-white text-xs">結束</label><input type="text" id="endTimeDisplay" readonly class="w-full bg-[#1a1a1a] border border-zinc-600 text-gray-400 rounded p-1 text-center cursor-not-allowed" value="自動計算"><input type="hidden" id="endTime"></div>
                                    </div>
                                    <p id="durationWarning" class="text-neon-pink text-xs mt-2 hidden font-bold"></p>
                                </div>
                            </div>
                            <button id="submitBtn" type="submit" class="w-full bg-neon-blue text-black font-bold py-3 rounded-lg hover:bg-[#00d0dd] transition shadow-lg mt-4 active:scale-95 cursor-pointer disabled:bg-gray-700 disabled:text-gray-500 disabled:cursor-not-allowed disabled:shadow-none" disabled>查詢空檔 <i class="fas fa-search ml-2"></i></button>
                        </form>
                    </div>

                    <div id="recommendationArea" class="hidden mt-6 bg-zinc-800 p-4 rounded-lg border border-red-500/50 animate-fade-in-down"><h4 class="text-red-400 font-bold mb-2"><i class="fas fa-times-circle"></i> 該時段已預約</h4><div id="recList" class="space-y-2"></div><button onclick="resetRec()" class="text-gray-500 text-xs mt-3 underline w-full text-center">重新選擇日期</button></div>

                    <div id="step2" class="hidden mt-6 border-t border-zinc-700 pt-6 animate-fade-in-down">
                        <div class="bg-zinc-800/80 p-4 rounded-xl border-l-4 border-green-500 mb-4">
                            <h4 class="text-green-400 font-bold text-lg mb-1"><i class="fas fa-check-circle"></i> 此時段尚有空位！</h4>
                            <p class="text-white">日期：<span id="displayDate" class="font-bold text-neon-pink"></span></p>
                            <p class="text-gray-300">時段：<span id="displayTime" class="font-bold"></span></p>
                            <div class="mt-3 border-t border-zinc-600 pt-3">
                                <p class="text-xs text-gray-400 mb-1">此方案包含內容：</p>
                                <ul id="step2Features" class="text-sm text-gray-300 list-disc list-inside space-y-1"></ul>
                            </div>
                        </div>
                        <div class="text-center"><button onclick="expandAddons()" class="w-full bg-white text-black font-bold py-3 rounded-lg hover:bg-gray-200 transition shadow">下一步：選擇加購服務 <i class="fas fa-chevron-down ml-2"></i></button></div>
                    </div>

                    <div id="step3" class="hidden mt-6 border-t border-zinc-700 pt-6 animate-fade-in-down">
                        <h3 class="text-white font-bold mb-4 flex items-center text-lg"><span class="bg-neon-pink text-white text-xs px-2 py-1 rounded mr-3">加購</span> 專屬服務選單</h3>
                        <div class="grid grid-cols-1 gap-3 mb-6" id="addonList"></div>
                        <button onclick="expandFinal()" class="w-full bg-neon-pink text-white font-bold py-3 rounded-lg hover:bg-pink-600 transition shadow-[0_0_15px_rgba(255,0,85,0.4)]">查看預估總價 <i class="fas fa-calculator ml-2"></i></button>
                    </div>

                    <div id="step4" class="hidden mt-6 border-t border-zinc-700 pt-6 animate-fade-in-down">
                        <div class="bg-white text-black p-5 rounded-xl shadow-2xl relative overflow-hidden">
                            <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-neon-blue to-neon-pink"></div>
                            <h4 class="font-bold text-xl mb-4 border-b border-gray-200 pb-2 text-center">RUINS BAR 預約試算</h4>
                            
                            <div class="space-y-3 text-sm mb-4">
                                <div class="flex justify-between items-center"><span class="text-gray-600 font-bold">預約方案</span><span id="invPlanName" class="font-bold text-right"></span></div>
                                <div class="flex justify-between items-center text-gray-500 text-xs"><span></span><span id="invPlanPrice"></span></div>
                                <div class="flex justify-between items-center border-t border-gray-200 pt-2"><span class="text-gray-600 font-bold">預約日期</span><span id="invDate" class="font-bold text-right text-xs"></span></div>
                                <div class="flex justify-between items-center text-gray-500 text-xs"><span>時段</span><span id="invTimeRange"></span></div>
                                <div class="flex justify-between items-center text-gray-500 text-xs"><span>總時數</span><span id="invTotalHours"></span></div>
                            </div>
                            
                            <div class="bg-gray-100 p-3 rounded-lg mb-4">
                                <p class="text-xs text-gray-500 mb-2 font-bold uppercase">加購項目</p>
                                <ul id="invAddons" class="text-sm space-y-2"></ul>
                            </div>

                            <div class="flex justify-between items-end border-t border-gray-300 pt-4 mb-6">
                                <span class="text-gray-600 font-bold text-lg">預估總價</span>
                                <span id="invTotal" class="text-3xl font-bold text-neon-pink"></span>
                            </div>

                            <div class="border-t-2 border-dashed border-gray-300 pt-4 mt-4">
                                <h5 class="font-bold text-gray-700 mb-3 flex items-center"><i class="fas fa-user-edit mr-2"></i> 預約人資料</h5>
                                
                                <div class="mb-3">
                                    <label class="block text-gray-500 text-xs font-bold mb-1">您的姓名 / 稱呼</label>
                                    <input type="text" id="guestName" class="w-full bg-gray-50 border border-gray-300 rounded p-2 text-sm focus:outline-none focus:border-neon-pink text-black" placeholder="例如：陳先生 / 小美">
                                </div>

                                <div>
                                    <label class="block text-gray-500 text-xs font-bold mb-1">聯絡電話 (台灣手機)</label>
                                    <input type="tel" id="guestPhone" maxlength="10" class="w-full bg-gray-50 border border-gray-300 rounded p-2 text-sm focus:outline-none focus:border-neon-pink text-black" placeholder="09xxxxxxxx">
                                </div>
                            </div>
                        </div>

                        <div class="mt-6 pb-4">
                            <button onclick="sendFinalToLine()" class="w-full bg-[#06c755] text-white font-bold py-4 rounded-lg hover:bg-[#05b54d] transition shadow-lg flex items-center justify-center text-xl animate-pulse"><i class="fab fa-line text-3xl mr-3"></i> 確認傳送預約</button>
                            <p class="text-center text-gray-500 text-xs mt-2">*送出後將自動開啟 LINE 視窗</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="copySuccessModal" class="hidden fixed inset-0 z-[80] flex items-center justify-center bg-black/90 backdrop-blur-md">
        <div class="bg-zinc-800 border-2 border-[#06c755] p-8 rounded-2xl shadow-[0_0_50px_rgba(6,199,85,0.3)] text-center max-w-sm mx-4 transform scale-100 transition-all">
            <div class="w-20 h-20 bg-[#06c755] rounded-full flex items-center justify-center mx-auto mb-6"><i class="fas fa-check text-4xl text-white"></i></div>
            <h3 class="text-2xl font-bold text-white mb-2">預約資料已複製！</h3>
            <p class="text-gray-300 mb-8 text-sm">請點擊下方按鈕開啟 LINE，並在對話框中 <span class="text-[#06c755] font-bold">貼上</span> 剛剛複製的文字即可。</p>
            <button onclick="goToLine()" class="w-full bg-[#06c755] hover:bg-[#05b54d] text-white font-bold py-4 rounded-xl text-lg transition shadow-lg">前往 LINE 貼上 <i class="fas fa-external-link-alt ml-2"></i></button>
            <button onclick="closeCopyModal()" class="mt-4 text-gray-500 text-sm underline">關閉視窗</button>
        </div>
    </div>

    <a href="javascript:void(0)" onclick="directLine()" class="sticky-btn" aria-label="Line洽詢"><i class="fa-brands fa-line"></i></a>

    <script>
        const LINE_ID = "@529ldsir"; 
        const LINE_DEEP_LINK = "line://ti/p/" + LINE_ID;
        const GAS_URL = "https://script.google.com/macros/s/AKfycbyiyxa6_OwdrWp_YQVkJ622DQgN23jHWTdCdt-lj0LBQ1Lm_pV2RWkvFQMigMpcg59NHQ/exec";

        // ★ V30: Standardized Package Features
        const PACKAGE_BASE_FEATURES = [
            '室內場地使用3小時(含進退場時間)',
            '室內竹編椅 30張',
            '現場投影 燈光 音響 空調設備使用',
            '精緻自助式點心25人份(共10樣鹹甜點心搭配 非每樣25份)'
        ];

        const RENTAL_BASE_FEATURES = [
            '室內場地使用3小時(含進退場時間)',
            '室內竹編椅 30張',
            '現場投影 燈光 音響 空調設備使用'
        ];

        const addOnOptions = [
            { id: 'time_plus', name: '場地加時 (1hr)', price: 3000 }, 
            { id: 'table_6', name: '6人折疊桌 (張)', price: 150 },
            { id: 'drink_na', name: '5L 自助無酒精飲品 (桶)', price: 800 },
            { id: 'drink_cocktail', name: '5L 自助雞尾酒調酒 (桶)', price: 2000 },
            { id: 'box_meal', name: '西點餐盒 (20盒起)', price: 4000 }, 
            { id: 'snack_basic', name: '自助式點心盤 (25人份)', price: 1500 },
            { id: 'snack_deluxe', name: '精緻自助點心 (25人份)', price: 15000 },
            { id: 'meal_deluxe', name: '精緻自助正餐 (25人份)', price: 25000 },
            { id: 'decor_table', name: '取餐區餐桌佈置', price: 5000 },
            { id: 'singer', name: '升級駐唱歌手 (2HR)', price: 1000 },
            { id: 'beer_cart', name: '啤酒推車 (48罐)', price: 3000 },
            { id: 'bartender_100', name: '駐場調酒 100杯 (2hr)', price: 35000 },
            { id: 'bartender_150', name: '駐場調酒 150杯 (2hr)', price: 40000 },
            { id: 'bartender_all', name: '駐場調酒 暢飲 (2.5hr)', price: 68000 },
            { id: 'upgrade_meal', name: '點心升級正餐 (補差價)', price: 10000 },
            { id: 'backdrop_name', name: '客製化姓名背板', price: 3000 },
            { id: 'host', name: '儀式主持人', price: 6000 },
            { id: 'lights_name', name: '新人專屬英文名燈條', price: 4000 },
            { id: 'backdrop_flower', name: '升級鮮花主題背板', price: 15000 },
            { id: 'wedding_flower', name: '證婚區升級鮮花佈置', price: 30000 }
        ];

        const bartenderGroup = ['bartender_100', 'bartender_150', 'bartender_all'];

        // ★ V30: Updated Plans Data
        const plansData = {
            'rental': { hasVariants: false, key: 'rental', name: '純場地租借', priceWeekday: 10000, priceWeekend: 15000, type: 'rental', includes: [], features: RENTAL_BASE_FEATURES, allowedAddons: ['time_plus', 'table_6', 'drink_na', 'drink_cocktail'] },
            'meeting': { hasVariants: false, key: 'meeting', name: '會議包場方案', priceWeekday: 12000, priceWeekend: 17000, type: 'pkg', includes: ['drink_na'], features: [...RENTAL_BASE_FEATURES, '6人折疊桌 * 5張', '2 桶 5L 無酒精飲品'], allowedAddons: ['time_plus', 'box_meal', 'snack_basic', 'snack_deluxe', 'meal_deluxe'] },
            'party': { hasVariants: false, key: 'party', name: '慶生 / 各式派對', priceWeekday: 28000, priceWeekend: 33000, type: 'pkg', includes: ['drink_na', 'drink_cocktail', 'snack_deluxe'], features: [...PACKAGE_BASE_FEATURES, '無酒精 5L*2 + 雞尾酒 5L*1'], allowedAddons: ['time_plus', 'decor_table', 'singer', 'beer_cart', 'bartender_100', 'bartender_150', 'bartender_all', 'upgrade_meal'] },
            'baby': { hasVariants: false, key: 'baby', name: '抓周 / 性別派對', priceWeekday: 45000, priceWeekend: 50000, type: 'pkg', includes: ['snack_deluxe'], features: [...PACKAGE_BASE_FEATURES, '溫馨氣球 + 拍照背板', '抓周道具 / 性別氣球'], allowedAddons: ['time_plus', 'backdrop_name', 'decor_table', 'host', 'upgrade_meal'] },
            'proposal': { hasVariants: false, key: 'proposal', name: '求婚包場', priceWeekday: 48000, priceWeekend: 52000, type: 'pkg', includes: [], features: [...PACKAGE_BASE_FEATURES, '溫馨氣球 + 拍照背板', 'MerryME 燈條佈置', '求婚花束 (乾燥/鮮花)'], allowedAddons: ['time_plus', 'lights_name', 'decor_table', 'backdrop_flower', 'upgrade_meal'] },
            'wedding': { hasVariants: true, key: 'wedding', variants: [ 
                { name: 'Welcome / After Party', priceWeekday: 35000, priceWeekend: 40000, includes: ['snack_deluxe', 'drink_na', 'drink_cocktail'], features: [...PACKAGE_BASE_FEATURES, '油桶桌 * 4', 'DJ 現場演出 (2HR)', '無酒精 5L*1 + 雞尾酒 5L*1'], allowedAddons: ['time_plus', 'decor_table', 'singer', 'beer_cart', 'bartender_100', 'bartender_150', 'bartender_all', 'upgrade_meal'] }, 
                { name: '戶外證婚 + 派對', priceWeekday: 108000, priceWeekend: 128000, includes: ['snack_deluxe', 'drink_na', 'drink_cocktail'], features: [...PACKAGE_BASE_FEATURES, '戶外證婚區 + 拱門 + 走道', '證婚區吐司椅', '戶外燈串 + 室內DJ (2HR)', '5L 無酒精飲品*1 + 雞尾酒*1'], allowedAddons: ['time_plus', 'decor_table', 'wedding_flower', 'singer', 'beer_cart', 'bartender_100', 'bartender_150', 'bartender_all', 'upgrade_meal'] } 
            ] },
            'custom': { hasVariants: false, name: '客製化方案', priceWeekday: 0, priceWeekend: 0, type: 'custom', includes: [], features: ['依需求報價'], allowedAddons: [] }
        };

        let selectedAddons = new Set();
        let bookingData = {};
        let currentPlan = { name: '', price: 0, type: '', includes: [], allowedAddons: [], features: [] };
        let isWeekend = false;
        let extraHoursCount = 0; 
        let currentSlotMode = '';

        window.onload = function() {
            setDatePickerMin(); 
            initCustomTimeSelects();
        };

        function handleCardClick(planKey) {
            const plan = plansData[planKey];
            if (plan.hasVariants) {
                const container = document.getElementById('subPlanContainer');
                container.innerHTML = '';
                plan.variants.forEach(v => {
                    const btn = document.createElement('div');
                    btn.className = "w-full bg-zinc-800 border border-zinc-600 text-white p-5 rounded-lg cursor-pointer hover:bg-zinc-700 hover:border-neon-pink transition group shadow-lg";
                    let featuresHtml = v.features.map(f => `<li class="flex items-start"><i class="fas fa-check text-neon-blue mt-1 mr-2 text-xs"></i><span class="text-sm text-gray-300">${f}</span></li>`).join('');
                    btn.innerHTML = `<div class="flex justify-between items-center mb-3 pb-2 border-b border-zinc-600"><span class="font-bold text-xl group-hover:text-neon-pink transition">${v.name}</span></div><ul class="space-y-1">${featuresHtml}</ul>`;
                    btn.onclick = () => confirmPlan(v, 'pkg', planKey);
                    container.appendChild(btn);
                });
                document.getElementById('subPlanModal').classList.remove('hidden');
            } else {
                confirmPlan(plan, plan.type, planKey);
            }
        }

        function confirmPlan(planObj, type, key) {
            currentPlan = { 
                key: key || planObj.key,
                name: planObj.name, 
                priceWeekday: planObj.priceWeekday,
                priceWeekend: planObj.priceWeekend,
                type: type, 
                includes: planObj.includes || [],
                allowedAddons: planObj.allowedAddons || [],
                features: planObj.features || [] 
            };
            document.getElementById('selectedPlanDisplay').innerText = planObj.name;
            document.getElementById('subPlanModal').classList.add('hidden');
            
            // 重置步驟
            document.getElementById('step1').classList.remove('hidden');
            document.getElementById('step2').classList.add('hidden');
            document.getElementById('step3').classList.add('hidden');
            document.getElementById('step4').classList.add('hidden');
            document.getElementById('recommendationArea').classList.add('hidden');
            
            // 清空資料
            selectedAddons.clear();
            extraHoursCount = 0;
            currentSlotMode = '';
            document.querySelectorAll('.slot-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('startTime').value = "";
            document.getElementById('endTimeDisplay').value = "自動計算";
            document.getElementById('dateInput').value = "";

            // 全日按鈕控制
            if (currentPlan.type === 'rental') {
                document.getElementById('btnAllDay').classList.remove('hidden');
            } else {
                document.getElementById('btnAllDay').classList.add('hidden');
            }

            // ★ 關鍵修改：先設定日期鎖定，再顯示視窗
            // 這樣確保視窗一渲染出來，input 的 min 屬性就已經生效
            setDatePickerMin();

            document.getElementById('bookingModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeModal() { document.getElementById('bookingModal').classList.add('hidden'); document.body.style.overflow = 'auto'; }
        function closeSubModal() { document.getElementById('subPlanModal').classList.add('hidden'); }

        function setDatePickerMin() {
            const today = new Date();
            // 預設 14 天，如果是租借或會議則 2 天
            const isShortTerm = (currentPlan.type === 'rental' || currentPlan.key === 'meeting');
            const leadDays = isShortTerm ? 2 : 14; 
            
            const minDate = new Date(today);
            minDate.setDate(today.getDate() + leadDays);
            
            const yyyy = minDate.getFullYear();
            const mm = String(minDate.getMonth() + 1).padStart(2, '0');
            const dd = String(minDate.getDate()).padStart(2, '0');
            const minDateStr = `${yyyy}-${mm}-${dd}`;
            
            const dateInput = document.getElementById("dateInput");
            if (dateInput) {
                dateInput.min = minDateStr;
            }
            
            // 更新文字提示
            const tipEl = document.getElementById("dateBlockTip");
            if(tipEl) {
                if(isShortTerm) {
                    tipEl.innerText = `ℹ️ 此方案需提前 2 天預約 (${minDateStr} 起)`;
                    tipEl.className = "text-xs text-blue-400 mb-2";
                } else {
                    tipEl.innerText = `ℹ️ 包套方案需提前 14 天預約 (${minDateStr} 起)`;
                    tipEl.className = "text-xs text-neon-pink mb-2";
                }
            }
            
            return minDateStr;
        }

        function selectSlot(mode) {
            currentSlotMode = mode;
            document.querySelectorAll('.slot-btn').forEach(b => b.classList.remove('active'));
            if(mode === 'lunch') document.getElementById('btnLunch').classList.add('active');
            if(mode === 'dinner') document.getElementById('btnDinner').classList.add('active');
            if(mode === 'allday') document.getElementById('btnAllDay').classList.add('active');
            document.getElementById('startTime').value = "";
            document.getElementById('endTimeDisplay').value = "自動計算";
            checkLogic();
        }

        function customTimeTrigger() {
            currentSlotMode = 'custom';
            document.querySelectorAll('.slot-btn').forEach(b => b.classList.remove('active'));
            updateEndTime();
        }

        function initCustomTimeSelects() {
            const s = document.getElementById('startTime');
            for (let i = 16; i <= 47; i++) {
                const hour = Math.floor(i / 2);
                const min = (i % 2) === 0 ? '00' : '30';
                const hStr = hour < 10 ? '0'+hour : hour;
                const time = `${hStr}:${min}`;
                s.add(new Option(time, time));
            }
        }

        function updateEndTime() {
            const startVal = document.getElementById('startTime').value;
            const endInput = document.getElementById('endTime');
            const endDisplay = document.getElementById('endTimeDisplay');
            if (!startVal) return;

            let durationHours = 3; 
            if (currentPlan.type === 'rental' && isWeekend) {
                durationHours = 2; 
            }

            const [sh, sm] = startVal.split(':').map(Number);
            let totalMin = sh * 60 + sm + (durationHours * 60);
            let eh = Math.floor(totalMin / 60);
            let em = totalMin % 60;
            let suffix = "";
            if (eh >= 24) { eh -= 24; suffix = " (+1)"; }
            const ehStr = eh < 10 ? '0'+eh : eh;
            const emStr = em === 0 ? '00' : em;
            const finalTime = `${ehStr}:${emStr}`;

            endInput.value = finalTime; 
            endDisplay.value = `${finalTime}${suffix} (計${durationHours}hr)`;
            checkLogic(); 
        }
        
        // ★ V33 FIX: 判斷是否為假日價格 (週六日全天 OR 週五16:00後)
        function isPeakTime(dateStr, slotMode, customStartStr) {
            if (!dateStr) return false;
            const d = new Date(dateStr);
            const day = d.getDay(); // 0=週日, 5=週五, 6=週六

            // 1. 週六、週日 -> 全天假日價
            if (day === 6 || day === 0) return true;

            // 2. 週五 -> 16:00 以後開始算假日價
            if (day === 5) {
                // 晚場 (17:00) -> 是假日價
                if (slotMode === 'dinner') return true;
                
                // 自訂時段：檢查開始時間是否 >= 16:00
                if (slotMode === 'custom' && customStartStr) {
                    const hour = parseInt(customStartStr.split(':')[0], 10);
                    if (hour >= 16) return true;
                }
                
                // 午場(11:00) 或 全日(09:00) -> 開始時間早於16:00 -> 算平日價
                return false; 
            }

            // 3. 週一至週四 -> 平日價
            return false;
        }
        
        // ★ V34 New: 重置預約進度 (當日期或時段改變時觸發)
        function resetProgress() {
            // 1. 隱藏後續步驟
            document.getElementById('step2').classList.add('hidden');
            document.getElementById('step3').classList.add('hidden');
            document.getElementById('step4').classList.add('hidden');
            document.getElementById('recommendationArea').classList.add('hidden');

            // 2. 清空已選加購與計數器 (防止價格混亂)
            selectedAddons.clear();
            extraHoursCount = 0;
            
            // 3. 重置時間計數器顯示 (如果有)
            const timeCount = document.getElementById('timeCount');
            if(timeCount) timeCount.innerText = '0';
        }

        function checkLogic() {
            const dateInput = document.getElementById('dateInput');
            const dateVal = dateInput.value;
            const timeSlot = document.getElementById('timeSlot').value;
            const customContainer = document.getElementById('customTimeContainer');
            const submitBtn = document.getElementById('submitBtn');
            const dayTypeLabel = document.getElementById('dayTypeLabel');
            const dateWarning = document.getElementById('dateWarning');

            // ★ 強力防呆：檢查日期是否合法
            if(dateVal) {
                // 重新取得限制日期
                const minDateStr = setDatePickerMin(); 
                
                // 如果選的日期 < 最小允許日期
                if (dateVal < minDateStr) {
                    alert(`⚠️ 日期無效！\n此方案需要提前預約。\n請選擇 ${minDateStr} 之後的日期。`);
                    dateInput.value = ""; // ★ 直接清空客人的選擇
                    dayTypeLabel.innerText = "";
                    submitBtn.disabled = true;
                    return; // 結束函式
                }

                // 日期合法，繼續判斷平假日
                const day = new Date(dateVal).getDay();
                isWeekend = (day === 0 || day === 6); 
                
                const currentPrice = isWeekend ? currentPlan.priceWeekend : currentPlan.priceWeekday;
                dayTypeLabel.innerText = (currentPrice === 0) ? "依專人報價" : `${isWeekend?"假日":"平日"}計價，方案基本費：$${currentPrice.toLocaleString()}`;
                
                if (timeSlot === 'custom') updateEndTime();
                
                // 隱藏舊的警告
                dateWarning.classList.add('hidden');
            }

            // 時段檢查
            if (timeSlot === 'custom') {
                customContainer.classList.remove('hidden');
                submitBtn.disabled = false;
            } else {
                customContainer.classList.add('hidden');
                // 如果有選按鈕時段，開啟送出；否則鎖定
                submitBtn.disabled = !currentSlotMode;
            }
        }

        function renderAddons() {
            const listContainer = document.getElementById('addonList');
            listContainer.innerHTML = '';

            addOnOptions.forEach(opt => {
                if (!currentPlan.allowedAddons.includes(opt.id)) return;

                const btn = document.createElement('div');
                const isIncluded = currentPlan.includes && currentPlan.includes.includes(opt.id);

                let displayPrice = opt.price;
                if (opt.id === 'time_plus') {
                    displayPrice = isWeekend ? 5000 : 3000;
                }

                if (isIncluded) {
                    btn.className = 'addon-btn included bg-black border border-green-500 rounded-lg p-3 flex justify-between items-center select-none';
                    btn.innerHTML = `<div class="flex items-center"><div class="check-icon w-5 h-5 rounded-full border border-green-500 mr-2 flex items-center justify-center opacity-100 bg-green-500 text-black"><i class="fas fa-check text-[10px]"></i></div><span class="text-sm font-bold text-green-400">${opt.name}</span></div><span class="text-green-400 text-sm font-bold">✅ 方案內含</span>`;
                    btn.onclick = () => { alert("此方案已包含，若需增加數量請直接聯繫客服。"); };
                    listContainer.appendChild(btn);
                } else if (opt.id === 'time_plus') {
                    btn.className = 'addon-btn bg-black border border-zinc-600 rounded-lg p-3 flex justify-between items-center transition select-none';
                    btn.innerHTML = `
                        <div class="flex items-center"><span class="text-sm font-bold text-white">${opt.name}</span></div>
                        <div class="flex items-center">
                            <span class="text-neon-pink text-xs font-bold mr-3">+$${displayPrice.toLocaleString()}</span>
                            <div class="flex items-center gap-2">
                                <div class="counter-btn" onclick="updateTime( -1, ${displayPrice})"><i class="fas fa-minus text-white text-xs"></i></div>
                                <span id="timeCount" class="text-white font-bold w-4 text-center">${extraHoursCount}</span>
                                <div class="counter-btn" onclick="updateTime( 1, ${displayPrice})"><i class="fas fa-plus text-white text-xs"></i></div>
                            </div>
                        </div>`;
                    listContainer.appendChild(btn);
                } else {
                    btn.className = 'addon-btn bg-black border border-zinc-600 rounded-lg p-3 flex justify-between items-center cursor-pointer hover:bg-zinc-800 transition select-none';
                    btn.onclick = () => toggleAddon(btn, opt.id);
                    // V33: Add ID to button to allow deselection by ID
                    btn.dataset.id = opt.id; 
                    btn.innerHTML = `<div class="flex items-center"><div class="check-icon w-5 h-5 rounded-full border border-zinc-500 mr-2 flex items-center justify-center opacity-30 transition-all"><i class="fas fa-check text-[10px]"></i></div><span class="text-sm font-bold text-white">${opt.name}</span></div><span class="text-neon-pink text-sm font-bold">+$${displayPrice.toLocaleString()}</span>`;
                    listContainer.appendChild(btn);
                }
            });
        }

        function updateTime(change, price) {
            let newCount = extraHoursCount + change;
            if (newCount < 0) newCount = 0;
            extraHoursCount = newCount;
            document.getElementById('timeCount').innerText = extraHoursCount;
            
            if (newCount > 0) {
                selectedAddons.add('time_plus');
            } else {
                selectedAddons.delete('time_plus');
            }
        }

        function toggleAddon(btn, id) {
            // V33: Bartender Mutex Logic
            if (bartenderGroup.includes(id) && !selectedAddons.has(id)) {
                bartenderGroup.forEach(bId => {
                    if (selectedAddons.has(bId)) {
                        selectedAddons.delete(bId);
                        // Find the button and remove class
                        const otherBtn = document.querySelector(`.addon-btn[data-id="${bId}"]`);
                        if(otherBtn) otherBtn.classList.remove('selected');
                    }
                });
            }

            if (selectedAddons.has(id)) { 
                selectedAddons.delete(id); 
                btn.classList.remove('selected'); 
            } else { 
                selectedAddons.add(id); 
                btn.classList.add('selected'); 
            }
        }

        function handleCheck(e) {
            e.preventDefault();
            const dateVal = document.getElementById('dateInput').value;
            const dateWarning = document.getElementById('dateWarning');
            
            // 1. 檢查日期
            if(!dateVal) { 
                alert("⚠️ 請先點擊日期欄位，選擇預約日期！"); 
                return; 
            }
            
            // 2. 檢查日期是否符合規定 (看有沒有紅字警告)
            if (!dateWarning.classList.contains('hidden')) {
                alert("⚠️ 您選擇的日期太近了，無法線上預約。\n急單請直接撥打客服電話：0932-828-922");
                return;
            }

            // 3. 檢查時段
            if(!currentSlotMode) { 
                alert("⚠️ 請選擇一個時段！\n(點選 午場、晚場 按鈕，或設定自訂時間)"); 
                return; 
            }

            const startTimeVal = document.getElementById('startTime').value;
            
            // 再次確認平假日
            isWeekend = isPeakTime(dateVal, currentSlotMode, startTimeVal);

            // 計算方案價格
            bookingData.planPrice = isWeekend ? currentPlan.priceWeekend : currentPlan.priceWeekday;
            
            if (currentSlotMode === 'allday') {
                if (currentPlan.type === 'rental') bookingData.planPrice = isWeekend ? 36000 : 20000;
                else if (currentPlan.key === 'meeting') bookingData.planPrice = isWeekend ? 40000 : 28000;
            }

            let reqStart = "", reqEnd = "", timeText = "";
            if(currentSlotMode === 'lunch') { reqStart = "11:00"; reqEnd = "14:00"; timeText = "午場 (11:00-14:00)"; }
            else if(currentSlotMode === 'dinner') { reqStart = "17:00"; reqEnd = "20:00"; timeText = "晚場 (17:00-20:00)"; }
            else if(currentSlotMode === 'allday') { reqStart = "09:00"; reqEnd = "21:00"; timeText = "全日包場 (09:00-21:00)"; }
            else { 
                reqStart = document.getElementById('startTime').value;
                reqEnd = document.getElementById('endTime').value; 
                if (!reqStart) { alert("請選擇開始時間"); return; }
                timeText = `自訂 (${reqStart}-${reqEnd})`;
            }

            bookingData.date = dateVal;
            bookingData.time = timeText;
            bookingData.planName = currentPlan.name;
            bookingData.baseStart = reqStart; 
            
            if(currentSlotMode === 'allday') bookingData.baseDuration = 12;
            else if(currentSlotMode === 'custom') {
                bookingData.baseDuration = (currentPlan.type === 'rental' && isWeekend) ? 2 : 3;
            } else {
                bookingData.baseDuration = 3;
            }

            const btn = e.target.querySelector('button[type="submit"]');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 查詢中...';
            btn.disabled = true; // 送出後才鎖定，防止重複按
            
            document.getElementById('step2').classList.add('hidden');
            document.getElementById('recommendationArea').classList.add('hidden');

            fetch(`${GAS_URL}?date=${dateVal}&start=${reqStart}&end=${reqEnd}`)
                .then(response => response.json())
                .then(data => {
                    btn.disabled = false;
                    btn.innerHTML = originalText;

                    if (data.available) {
                        document.getElementById('displayDate').innerText = dateVal;
                        document.getElementById('displayTime').innerText = timeText;
                        
                        const featureList = document.getElementById('step2Features');
                        featureList.innerHTML = '';
                        currentPlan.features.forEach(f => {
                            featureList.innerHTML += `<li class="text-gray-300"><i class="fas fa-check text-green-500 mr-2 text-xs"></i>${f}</li>`;
                        });

                        renderAddons();
                        const step2 = document.getElementById('step2');
                        step2.classList.remove('hidden');
                        step2.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    } else {
                        showRecommendations(data.recommendations);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    btn.disabled = false;
                    btn.innerHTML = originalText;
                    alert("查詢連線失敗，請檢查網路或稍後再試。");
                });
        }

        function showRecommendations(recs) {
            // 過濾不符合前置天數的日期
            const today = new Date();
            const leadDays = (currentPlan.type === 'rental' || currentPlan.key === 'meeting') ? 2 : 14;
            const minDate = new Date(today);
            minDate.setDate(today.getDate() + leadDays);

            const validRecs = recs.filter(r => new Date(r.date) >= minDate);

            const area = document.getElementById('recommendationArea');
            const list = document.getElementById('recList');
            list.innerHTML = '';

            if (validRecs && validRecs.length > 0) {
                validRecs.forEach(r => {
                    const div = document.createElement('div');
                    div.className = 'flex justify-between items-center bg-black/40 p-3 rounded hover:bg-black/60 cursor-pointer transition border border-zinc-700 hover:border-neon-blue';
                    div.innerHTML = `<div><span class="text-xs bg-gray-600 text-white px-2 py-0.5 rounded mr-2">${r.label}</span><span class="text-white text-sm font-bold">${r.date}</span><span class="text-neon-blue text-xs ml-1">${r.start} - ${r.end}</span></div><i class="fas fa-chevron-right text-gray-500"></i>`;
                    div.onclick = () => {
                        document.getElementById('dateInput').value = r.date;
                        
                        // ★ V33 FIX: 確保全日包場 (09:00) 能正確觸發按鈕選取
                        if(r.start === '11:00') selectSlot('lunch');
                        else if(r.start === '17:00') selectSlot('dinner');
                        else if(r.start === '09:00') selectSlot('allday'); 
                        else {
                             // 自訂時段
                             document.getElementById('startTime').value = r.start;
                             customTimeTrigger();
                        }
                        
                        // 觸發查詢
                        document.getElementById('submitBtn').click();
                    };
                    list.appendChild(div);
                });
            } else { 
                list.innerHTML = '<p class="text-gray-500 text-sm">暫無符合預約規則的相近推薦。</p>'; 
            }
            area.classList.remove('hidden');
            area.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function resetRec() {
            document.getElementById('recommendationArea').classList.add('hidden');
            document.getElementById('dateInput').focus();
        }

        function expandAddons() { document.getElementById('step3').classList.remove('hidden'); document.getElementById('step3').scrollIntoView({ behavior: 'smooth', block: 'start' }); }
        
        function expandFinal() {
            document.getElementById('invPlanName').innerText = bookingData.planName;
            document.getElementById('invPlanPrice').innerText = (bookingData.planPrice === 0) ? "依報價" : "$ " + bookingData.planPrice.toLocaleString();
            
            const listContainer = document.getElementById('invAddons');
            listContainer.innerHTML = '';
            let totalAddonPrice = 0;
            
            // Calculate Final Duration
            let finalDuration = bookingData.baseDuration + extraHoursCount;
            // Recalculate End Time String for Receipt
            // Need to parse baseStart again (HH:MM)
            let [sh, sm] = bookingData.baseStart.split(':').map(Number);
            let totalMin = sh * 60 + sm + (finalDuration * 60);
            let eh = Math.floor(totalMin / 60);
            let em = totalMin % 60;
            let suffix = "";
            if (eh >= 24) { eh -= 24; suffix = " (+1)"; }
            let finalTimeStr = `${eh < 10 ? '0'+eh : eh}:${em === 0 ? '00' : em}${suffix}`;
            
            document.getElementById('invTimeRange').innerText = `${bookingData.baseStart} - ${finalTimeStr}`;
            document.getElementById('invTotalHours').innerText = `共 ${finalDuration} 小時 ${extraHoursCount>0 ? `(原${bookingData.baseDuration}+加${extraHoursCount})` : ''}`;

            const dayLabel = isWeekend ? "(假日)" : "(平日)";
            document.getElementById('invDate').innerText = `${bookingData.date} ${dayLabel}`;

            if (currentPlan.includes && currentPlan.includes.length > 0) {
                currentPlan.includes.forEach(incId => {
                    const opt = addOnOptions.find(o => o.id === incId);
                    if(opt) listContainer.innerHTML += `<li class="flex justify-between items-center text-gray-400 text-xs italic"><span>${opt.name}</span> <span>(方案內含)</span></li>`;
                });
            }

            if(selectedAddons.size === 0 && extraHoursCount === 0) { listContainer.innerHTML += '<li class="text-gray-500 italic mt-2">無額外加購</li>'; } 
            else {
                addOnOptions.forEach(opt => {
                    if (opt.id === 'time_plus' && extraHoursCount > 0) {
                        let price = isWeekend ? 5000 : 3000;
                        let subtotal = price * extraHoursCount;
                        listContainer.innerHTML += `<li class="flex justify-between items-center border-b border-gray-200 pb-1 mt-2"><span>加購時數 x ${extraHoursCount}hr</span> <span class="text-gray-600 font-medium">+$${subtotal.toLocaleString()}</span></li>`;
                        totalAddonPrice += subtotal;
                    }
                    else if(selectedAddons.has(opt.id) && opt.id !== 'time_plus') {
                        listContainer.innerHTML += `<li class="flex justify-between items-center border-b border-gray-200 pb-1 mt-2"><span>${opt.name}</span> <span class="text-gray-600 font-medium">+$${opt.price.toLocaleString()}</span></li>`;
                        totalAddonPrice += opt.price;
                    }
                });
            }
            
            const finalTotal = bookingData.planPrice + totalAddonPrice;
            document.getElementById('invTotal').innerText = (bookingData.planPrice === 0) ? "另行報價" : "NT$ " + finalTotal.toLocaleString();
            bookingData.finalTotal = finalTotal;
            bookingData.finalEndTime = finalTimeStr; 
            
            document.getElementById('step4').classList.remove('hidden');
            document.getElementById('step4').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // ★ V35 New: 萬用複製函式 (解決 HTTP/手機瀏覽器 複製失敗問題)
        function copyToClipboard(text) {
            return new Promise((resolve, reject) => {
                // 方法 A: 現代 API (需 HTTPS)
                if (navigator.clipboard && window.isSecureContext) {
                    navigator.clipboard.writeText(text).then(resolve).catch(() => {
                        // 如果 API 失敗，嘗試方法 B
                        fallbackCopy(text, resolve, reject);
                    });
                } else {
                    // 方法 B: 傳統相容模式
                    fallbackCopy(text, resolve, reject);
                }
            });
        }

        function fallbackCopy(text, resolve, reject) {
            try {
                const textArea = document.createElement("textarea");
                textArea.value = text;
                
                // 確保 textArea 不會被看到，但要在視窗內才能選取
                textArea.style.position = "fixed";
                textArea.style.left = "0";
                textArea.style.top = "0";
                textArea.style.opacity = "0";
                
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                
                const successful = document.execCommand('copy');
                document.body.removeChild(textArea);
                
                if (successful) resolve();
                else reject();
            } catch (err) {
                reject(err);
            }
        }

        // ★ V35 FIX: 使用萬用複製函式
        function sendFinalToLine() {
            // 1. 取得輸入值
            const name = document.getElementById('guestName').value.trim();
            const phone = document.getElementById('guestPhone').value.trim();

            // 2. 驗證
            if (!name) { alert("❌ 請填寫「預約人姓名」"); document.getElementById('guestName').focus(); return; }
            const phoneRegex = /^09\d{8}$/;
            if (!phoneRegex.test(phone)) { alert("❌ 請填寫正確的「台灣手機號碼」"); document.getElementById('guestPhone').focus(); return; }

            // 3. 組合訊息
            let msg = `您好！我想預約 RUINS BAR 廢墟場地 🥂\n\n`;
            msg += `👤 姓名：${name}\n`;
            msg += `📱 電話：${phone}\n`;
            msg += `------------------------\n`;
            msg += `📅 日期：${bookingData.date} ${isWeekend?"(假日)":"(平日)"}\n`;
            msg += `⏰ 時段：${bookingData.baseStart} - ${bookingData.finalEndTime}\n`;
            msg += `📋 方案：${bookingData.planName}\n`;
            
            if (currentPlan.includes && currentPlan.includes.length > 0) {
                msg += `\n✅ 內含項目：\n`;
                currentPlan.includes.forEach(incId => {
                    const opt = addOnOptions.find(o => o.id === incId);
                    if(opt) msg += `- ${opt.name}\n`;
                });
            }

            if(selectedAddons.size > 0 || extraHoursCount > 0) { 
                msg += `\n➕ 加購/升級：\n`; 
                if(extraHoursCount > 0) msg += `- 加購時數 ${extraHoursCount}小時\n`;
                addOnOptions.forEach(opt => { 
                    if(selectedAddons.has(opt.id) && opt.id !== 'time_plus') { 
                        msg += `- ${opt.name}\n`; 
                    } 
                }); 
            } 
            
            if(bookingData.planPrice === 0) { msg += `\n💰 預估總價：待專人報價\n`; } 
            else { msg += `\n💰 預估總價：NT$ ${bookingData.finalTotal.toLocaleString()}\n`; }
            msg += `\n請協助確認檔期與最終報價，謝謝！`;
            
            // 4. 執行複製
            copyToClipboard(msg).then(() => {
                // ★ 修改處：複製成功後，先關閉後面的預約表單
                closeModal(); 
                
                // 再顯示成功彈窗
                document.getElementById('copySuccessModal').classList.remove('hidden');
            }).catch(() => {
                alert("複製失敗，請手動截圖");
                window.location.href = LINE_DEEP_LINK;
            });
        }

        function goToLine() {
            // ★ 修改處：點擊後先關閉提示窗，再跳轉
            closeCopyModal();
            window.location.href = LINE_DEEP_LINK;
        }
        function closeCopyModal() { document.getElementById('copySuccessModal').classList.add('hidden'); }
        function directLine() { window.location.href = LINE_DEEP_LINK; }
    </script>
</body>
</html>